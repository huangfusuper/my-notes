# Redis RedLock究竟是不是分布式锁分布式环境下的银弹？

## 一、概述

在这个技术不断更新迭代的情况下，分布式这个概念，在企业中的权重越来越高！谈及分布式时，不可避免一定会提到分布式锁，现阶段分布式锁的实现方式主流的有三种实现方式,` Zookeeper`、`DB`、`Redis`,我们本篇文章以Redis为例！

从我们的角度来看，这三个属性是有效使用分布式锁所需的最低保证。

1. 安全特性：互斥。在任何给定时刻，只有一个客户端可以持有锁。
2. 活力属性：无死锁。最终，即使锁定资源的客户端崩溃或分区，也始终可以获得锁。
3. 活动性：容错能力。只要大多数Redis节点都处于运行状态，客户端就可以获取和释放锁。

## 二、redis多节点实现分布式锁带来的挑战

我们使用Redis锁定资源的最简单方法是：

1. 在实例中创建锁。
2. 锁通常使用Redis过期功能在有限时间存在，因此最终将被释放，最终超过给定期限会被删除。
3. 当客户端需要释放资源时，它将删除锁。

乍一看，似乎并没有什么问题。但是不妨我们深究一下，这种实现方案在redis单机环境下似乎并没有什么问题！但是如果节点宕了呢？好吧，那么让我们添加一个`slave`节点！如果主服务器宕机了，就使用这个节点！但是我们不妨来看看她真的能保证可用吗？

在谈论这个的致命缺陷时，我们需要了解一个知识点，`Redis复制是异步的。`

1. 客户端A获取主服务器中的锁。
2. 在将锁复制传输到从机之前，主机崩溃。
3. `slave`晋升为`master`。
4. 客户端B获取锁，因为从机并没有该锁的对象，获取成功！